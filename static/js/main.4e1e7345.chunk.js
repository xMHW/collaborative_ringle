(this.webpackJsonpdocument=this.webpackJsonpdocument||[]).push([[0],{137:function(e,t,n){},139:function(e,t,n){},268:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n.n(r),a=n(71),o=n.n(a),i=(n(137),n(57)),u=n(5),s=n.n(u),f=n(17),l=n(7),d=(n(139),n(6)),g=n(130),O=n.n(g);function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e.includes("undefined")){var c=null;t&&(c="Bearer "+t);var a=null;return a=r?{method:n,headers:{Authorization:c,"Content-Type":"application/json"},body:JSON.stringify(r)}:{method:n,headers:{Authorization:c,"COntent-Type":"application/json"}},O()(e,a).then((function(e){return e.json()})).then((function(e){return e}),(function(e){return{success:!1,error:e}}))}}var j=n(3),b=function(e,t){var n=Object(r.useRef)(!1);Object(r.useEffect)((function(){n.current?e():n.current=!0}),t)},p=n(12),v=function(e){var t=e.uuid,n=e.currentCard,c=e.findPrevCard,a=e.findNextCard,o=e.createdNewCardAtTree,i=e.setCurrentCard,u=e.deleteCurrentCardFromTree,g=e.setBackSpace,O=e.backSpace,v=e.mergePending,S=e.setMergePending,C=e.cardCreated,k=e.setCardCreated,w=e.goUp,x=e.setGoUp,m=e.socket,F=(e.setSocket,Object(r.useState)((function(){return j.EditorState.createEmpty()}))),y=Object(l.a)(F,2),T=y[0],E=y[1],A=new Date,B=Object(r.useState)(),P=Object(l.a)(B,2),D=P[0],L=P[1],R=Object(d.f)().userId,N=Object(r.useState)(),I=Object(l.a)(N,2),M=(I[0],I[1]),J=Object(r.useState)(!1),W=Object(l.a)(J,2),G=(W[0],W[1],Object(r.useState)(!1)),U=Object(l.a)(G,2),_=U[0],K=U[1],z=Object(r.useState)(!1),H=Object(l.a)(z,2),q=(H[0],H[1]),Q=Object(r.useState)({AnchorOffset:0,FocusOffset:0}),V=Object(l.a)(Q,2),X=V[0],Y=V[1],Z=Object(r.useRef)(),$="http://54.180.147.138";Object(r.useEffect)((function(){if(null!=m&&null!=T&&0!=_){var e=T.getCurrentContent(),n=Object(j.convertToRaw)(e),r=T.getSelection(),c=r.getAnchorOffset(),a=r.getFocusOffset(),o={AnchorDelta:c-X.AnchorOffset,FocusDelta:a-X.FocusOffset};m.emit("send-changes",{delta:n,id:R,objectId:t,oldOffsets:X,offsetDelta:o}),K(!1)}}),[m,T,_]);Object(r.useEffect)((function(){if(null!=m&&null!=T){var e=function(e){if(e.id!=R&&e.objectId==t){var n,r,c,a=Object(j.convertFromRaw)(e.delta),o=T.getSelection(),i=o.getAnchorOffset(),u=function(e,t,n){return t?n.set("focusOffset",t).set("anchorOffset",t):n.set("focusOffset",e).set("anchorOffset",e)}((n=i,r=e.oldOffsets.AnchorOffset,c=e.offsetDelta.AnchorDelta,n<=r?n:n+c),function(e,t,n){return t<e&&e<n?t:n<e&&e<t?n:null}(i,e.oldOffsets.AnchorOffset,e.oldOffsets.FocusOffset),o),s=j.EditorState.set(T,{currentContent:a}),f=j.EditorState.acceptSelection(s,u);E(f)}};return m.on("receive-changes",e),function(){m.off("receive-changes",e)}}}),[m,T]),b((function(){var e=A.getHours()+":"+A.getMinutes()+":"+A.getSeconds();L(e),ce(t)}),[T]);var ee=function(e,t){var n=e.getCurrentContent(),r=t.getCurrentContent(),c=n.getPlainText(),a=n.getFirstBlock().getCharacterList(),o=r.getPlainText(),i=r.getFirstBlock().getCharacterList();return c!=o||a!=i},te=function(e,t){var n=e.getSelection(),r=t.getSelection(),c=n.getStartOffset(),a=r.getStartOffset(),o=n.getFocusOffset(),i=r.getFocusOffset();return c!=a||o!=i};b((function(){if(n==t&&Z.current){if(Z.current.focus(),C){var e=T.getCurrentContent(),r=T.getSelection(),c=e.getPlainText().length,a=r.merge({focusOffset:c,anchorOffset:c,hasFocus:!0});E(j.EditorState.acceptSelection(T,a)),k(!1)}if(O){if(E(j.EditorState.moveFocusToEnd(T)),v){var o=T.getCurrentContent(),i=T.getSelection(),u=i.getFocusKey(),s=o.getPlainText().length,f=ae(o,v),l=Object(j.convertToRaw)(f),d=j.EditorState.createWithContent(Object(j.convertFromRaw)(l)),h=i.merge({focusKey:u,focusOffset:s,anchorOffset:s,hasFocus:!0});E(j.EditorState.acceptSelection(d,h)),S(null)}g(!1)}w&&(E(j.EditorState.moveFocusToEnd(T)),x(!1))}}),[n]),Object(r.useEffect)((function(){C||ne(t)}),[]);var ne=function(){var e=Object(f.a)(s.a.mark((function e(t){var n,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("".concat($,"/card/find"),null,"POST",{_id:t});case 2:n=e.sent,M(n),n&&(r=JSON.parse(n.content),c=j.EditorState.createWithContent(Object(j.convertFromRaw)(r)),E(c));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=Object(f.a)(s.a.mark((function e(){var t,n,r,c,a,u=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:j.EditorState.createEmpty(),n=t.getCurrentContent(),r=Object(j.convertToRaw)(n),c=JSON.stringify(r),e.next=6,h("".concat($,"/card/create"),null,"POST",{content:c,created:D,updater:R});case 6:a=e.sent,o(a._id),i(a._id);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=Object(f.a)(s.a.mark((function e(t){var n,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T.getCurrentContent(),r=Object(j.convertToRaw)(n),c=JSON.stringify(r),e.next=5,h("".concat($,"/card/update"),null,"POST",{_id:t,content:c,created:D,updater:R});case 5:e.sent;case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(e,t){e.getBlockMap();var n=e.getLastBlock(),r=oe(n,t);return j.ContentState.createFromBlockArray([r])},oe=function(e,t){return new j.ContentBlock({key:e.getKey(),text:e.getText().concat(t.getText()),characterList:e.getCharacterList(),depth:e.getDepth(),data:e.getData()})};return Object(p.jsx)("div",{className:"cards",onKeyDown:function(e){if(8===e.keyCode){var n=T.getCurrentContent(),r=n.getPlainText().length,o=T.getSelection(),i=o.getFocusOffset(),s=(n.getBlockMap(),n.getFirstBlock()),f=o.getAnchorOffset();if(0===i)if(0===r)g(!0),u(t);else{if(0!=f)return;g(!0),S(s),u(t)}}if("ArrowUp"===e.key)return 0===T.getSelection().getStartOffset()&&c(t),void console.log("arrow up");if("ArrowDown"===e.key)return function(){var e=T.getCurrentContent().getLastBlock().getLength();T.getSelection().getStartOffset()===e&&a(t)}(),void console.log("arrow down");if("ArrowLeft"===e.key){T.getCurrentContent();0===T.getSelection().getFocusOffset()&&(console.log("Arrow left"),c(t))}if("ArrowRight"===e.key){var l=T.getCurrentContent();T.getSelection().getFocusOffset()===l.getPlainText().length&&(console.log("Arrow right"),a(t))}if(e.key,13===e.keyCode){var d=T.getCurrentContent();if(T.getSelection().getFocusOffset()==d.getPlainText().length){console.log("newCard!!!!!!");var O=d.getFirstBlock(),h=j.ContentState.createFromBlockArray([O]),b=j.EditorState.createWithContent(h);E(b),k(!0),re()}else{E(j.EditorState.undo(T));var p=T.getSelection(),v=j.Modifier.splitBlock(d,p),C=j.ContentState.createFromBlockArray([v.getFirstBlock()]),w=j.EditorState.createWithContent(C);E(w);var x=j.ContentState.createFromBlockArray([v.getLastBlock()]),m=j.EditorState.createWithContent(x);re(m)}}},children:Object(p.jsx)(j.Editor,{editorState:T,onChange:function(e){console.log(ee(T,e));var n=T.getSelection(),r=n.getAnchorOffset(),c=n.getFocusOffset();Y({AnchorOffset:r,FocusOffset:c}),ee(T,e)&&K(!0),te(T,e)&&q(!0),E(e),i(t)},ref:Z})})},S=n(132),C="http://54.180.147.138",k=function(){var e=Object(r.useState)([]),t=Object(l.a)(e,2),n=t[0],c=t[1],a=Object(r.useState)(null),o=Object(l.a)(a,2),u=o[0],g=o[1],O=Object(r.useState)(!1),j=Object(l.a)(O,2),k=(j[0],j[1],Object(r.useState)([])),w=Object(l.a)(k,2),x=(w[0],w[1],Object(d.f)().userId),m=Object(r.useState)(!1),F=Object(l.a)(m,2),y=F[0],T=F[1],E=Object(r.useState)(null),A=Object(l.a)(E,2),B=A[0],P=A[1],D=Object(r.useState)(!1),L=Object(l.a)(D,2),R=L[0],N=L[1],I=Object(r.useState)(!1),M=Object(l.a)(I,2),J=M[0],W=M[1],G=Object(r.useState)(),U=Object(l.a)(G,2),_=U[0],K=U[1],z=Object(r.useState)(!1),H=Object(l.a)(z,2),q=H[0],Q=H[1],V=Object(r.useState)(0),X=Object(l.a)(V,2),Y=X[0],Z=X[1];Object(r.useEffect)((function(){ee()}),[]),Object(r.useEffect)((function(){$(n.length)&&Q(!0),Z(n.length)}),[n]);var $=function(e){return Y!=e};Object(r.useEffect)((function(){var e=Object(S.io)("http://54.180.147.138:5000");return K(e),function(){e.disconnect()}}),[]),b((function(){null!=_&&null!=n&&0!=q&&(_.emit("send-tree-changes",{delta:n,id:x}),Q(!0))}),[_,n,q]),b((function(){if(null!=_&&null!=n){_.on("receive-tree-changes",(function(e){e.id!=x&&c(e.delta)}))}}),[_,n]);var ee=function(){var e=Object(f.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("".concat(C,"/tree/find/all"),null,"GET",null);case 2:t=e.sent,c(t[0].cards);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=Object(f.a)(s.a.mark((function e(t){var n,r,a,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("".concat(C,"/card/find/all"),null,"GET",null);case 2:for(n=e.sent,r=n.map((function(e){return e._id})),a=0;a<t.length;a++)-1===r.indexOf(t[a])&&(o=t.indexOf(t[a]),t.splice(o,1));c(t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=Object(f.a)(s.a.mark((function e(t,n){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return te(n),e.next=3,h("".concat(C,"/tree/update"),null,"POST",{page:t,cards:["608b3f2157e25818a1d3ff16","608b3f3557e25818a1d3ff17"]});case 3:e.sent;case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),re=function(e,t){var r=n.indexOf(e);-1!==r&&0!==r&&(g(n[r-1]),W(!0))},ce=function(e){var t=n.indexOf(e);-1!==t?n[t+1]?(console.log("Nothing went wrong!"),g(n[t+1])):console.log("There is no Card After this one!!!!!"):console.log("That card uuid is Invalid!!!!!!!")},ae=function(e){var t=n.indexOf(u),r=[];if(-1===t)r=[].concat(Object(i.a)(n),[e]),c(r);else{var a=Object(i.a)(n);a.splice(t+1,0,e),c(r=a)}ne(1,r)},oe=function(){var e=n.indexOf(u);g(n[e-1]);var t=[];if(-1!==e){var r=Object(i.a)(n);r.splice(e,1),c(t=r),ne(1,t)}};return Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("div",{style:{padding:16,width:1100,backgroundColor:"white",maxWidth:1100,borderRadius:8,display:"inline-block"},children:n.map((function(e){return Object(p.jsx)(v,{uuid:e,currentCard:u,findPrevCard:re,findNextCard:ce,createdNewCardAtTree:ae,setCurrentCard:g,deleteCurrentCardFromTree:oe,setBackSpace:T,backSpace:y,mergePending:B,setMergePending:P,cardCreated:R,setCardCreated:N,goUp:J,setGoUp:W,socket:_,setSocket:K},e)}))})})},w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,269)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))},x=n(55);o.a.render(Object(p.jsx)(c.a.StrictMode,{children:Object(p.jsx)(x.a,{children:Object(p.jsx)(d.c,{children:Object(p.jsx)(d.a,{exact:!0,path:"/:userId",component:k})})})}),document.getElementById("root")),w()}},[[268,1,2]]]);
//# sourceMappingURL=main.4e1e7345.chunk.js.map